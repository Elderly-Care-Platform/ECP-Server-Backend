
<div ng-controller="EditorController" class="by_editor_wrap">
    <div class="col-md-12 no-padding margin-bottom-35">

        <div class="col-md-12 no-padding  list-head dp-block">PUBLISH YOUR STORY
        </div>

        <div class="col-md-12 no-padding bg-gray-h1">
            <div class="bg-green-h2" style="width: 216px;"></div>
        </div>
    </div>


    <div class="col-md-12 no-padding form-header-content margin-bottom-15">Please enter a title of your
        story / article
    </div>

    <div class=" col-md-12 no-padding margin-bottom-35 register-page">
        <input type="text" class="username-textbox textbox "name="username" ng-model="editor.subject">
    </div>


    <div class=" col-md-12 no-padding margin-bottom-35 register-page">
        <form id="UploadImage12" action="UploadFile" method="post" enctype="multipart/form-data">
            <label class="myLabel">
                <input  name="sp" id="sp"  type="file" required onchange="javascript:uploadImage(this)"/>
                <span>Please upload<br> your main <br>photo (optional)</span>
            </label>
        </form>
        <input type="text" id="articleTitleImage" ng-model="editor.articlePhotoFilename" value="" style="display:none"/>

    </div>


    <div class="col-md-12 no-padding margin-bottom-35 byEditor">
        <textarea id="article_textArea" class="textbox about-dependent" rows="3" ></textarea>
    </div>

    <div class="col-md-12 no-padding form-header-content margin-bottom-15">
       <a> Please select at least one category where your story would appear</a>
    </div>

    <div class="col-md-12 no-padding margin-bottom-35 form-header-content2">
        <div class="panel-group acc-v1" id="accordion-1">
            <div class="panel panel-default by_accordian" ng-repeat="category in $root.discussCategoryList">
                <div class="panel-heading">
                    <h4 class="panel-title by_editor_ParentCategories" ng-if="category.childCount <= 0">
                        <label>
                            {{category.name}}

                            <input type="checkbox" onchange="BY.editorCategoryList.selectCategory(this)" value="{{category.id}}"  ng-model="preSelected[category.id]">
                        </label>
                    </h4>
                    <h4 class="panel-title by_editor_ParentCategories" ng-if="category.childCount > 0">
                        <a class="accordion-toggle collapsed" data-toggle="collapse" data-parent="#accordion-1" href={{"#"+category.id}} onclick="return false;">
                            {{category.name}}
                        </a>
                        <a class="triangle-down accordion-toggle collapsed" data-toggle="collapse" data-parent="#accordion-1" href={{"#"+category.id}} onclick="return false;"></a>
                    </h4>
                </div>
                <div id={{category.id}} class="col-md-12 whiteBg by_editor_SubCategories panel-collapse collapse">
                    <div class="panel-body col-md-4" ng-repeat="subCategory in category.children">
                        <input type="checkbox" onchange="BY.editorCategoryList.selectCategory(this)" value={{subCategory.id}} ng-model="preSelected[subCategory.id]"> <span>{{subCategory.name}}</span>
                    </div>
                </div> <div style="clear:both"></div>

            </div>
        </div>
    </div>


    <div ng-show="errorMsg"><font color="red">{{errorMsg}}</font></div>

    <div class="col-md-12 no-padding margin-bottom-35">
        <button class="btn btn-big btn-default pull-right by_btn_submit by-editor-submit-btn" disabled ng-click="postContent('A')">submit</button>
    </div>
    
<script type="text/javascript">
    var tinyEditor = BY.addEditor({"editorTextArea":"article_textArea"});
    $("#UploadImage12").bind('submit', function(e) {
    	var postData = new FormData(jQuery('#UploadImage12')[0]);
    	$.ajax(
    		    {
    		        url : 'UploadFile?transcoding=true',
    		        type: "POST",
    		        enctype:"multipart/form-data",
    		        data : postData,
    		      //  contentType: "application/json",
    		        cache: false,
				    contentType: false,
				    processData: false,
    		        success:function(data, textStatus, jqXHR) 
    		        {
    		            $("#articleTitleImage").val(JSON.stringify(data));
    		            $("#articleTitleImage").trigger('input');
    		        },
    		        error: function(jqXHR, textStatus, errorThrown) 
    		        {
    		        	console.log(textStatus);
    		        	alert("Image upload failed");
    		        }
    		    });
        e.preventDefault();
  });
    function uploadImage(input){
    	if (input.files && input.files[0]) {
            var reader = new FileReader();
            
            reader.onload = function (e) {
            	$('.myLabel').css('background-image', 'url(' + e.target.result + ')')
            }
            
            reader.readAsDataURL(input.files[0]);
            $('#UploadImage12').submit();
            
            //input.form.submit();
        }
    }
    
    
</script>
</div>



